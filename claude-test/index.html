<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claude API „ÉÜ„Çπ„Çø„Éº</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <style>
    /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Áî®„ÅÆ„Çπ„Çø„Ç§„É´ */
    @keyframes gradientBg {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    body {
      font-family: 'Inter', 'Helvetica', sans-serif;
      background-color: #0f172a;
      color: #e2e8f0;
    }

    h1 {
      background: linear-gradient(90deg, #6366f1, #ec4899, #8b5cf6);
      background-size: 200% 200%;
      animation: gradientBg 6s ease infinite;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: inline-block;
    }

    #response {
      font-family: 'Fira Code', monospace;
      line-height: 1.6;
    }

    #loading {
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #8b5cf6;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* „Éï„Çß„Éº„Éâ„Ç§„É≥ÂäπÊûú */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6 text-purple-400">Claude API „ÉÜ„Çπ„Çø„Éº ü¶ë</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-semibold mb-4 text-blue-400">APIË®≠ÂÆö</h2>
        
        <div class="mb-4">
          <label class="block text-gray-300 mb-2" for="api-key">API Key</label>
          <input type="password" id="api-key" class="w-full bg-gray-700 text-white p-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none" placeholder="sk-ant-api03-...">
        </div>
        
        <div class="mb-4">
          <label class="block text-gray-300 mb-2" for="model">„É¢„Éá„É´</label>
          <select id="model" class="w-full bg-gray-700 text-white p-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none">
            <option value="claude-3-opus-20240229">claude-3-opus-20240229</option>
            <option value="claude-3-sonnet-20240229">claude-3-sonnet-20240229</option>
            <option value="claude-3-haiku-20240307">claude-3-haiku-20240307</option>
            <option value="claude-3-5-sonnet-20240620">claude-3-5-sonnet-20240620</option>
            <option value="claude-3-5-haiku-20241022">claude-3-5-haiku-20241022</option>
          </select>
        </div>
        
        <div class="mb-6">
          <label class="block text-gray-300 mb-2" for="system-prompt">„Ç∑„Çπ„ÉÜ„É†„Éó„É≠„É≥„Éó„Éà</label>
          <textarea id="system-prompt" class="w-full bg-gray-700 text-white p-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none h-24" placeholder="„ÅÇ„Å™„Åü„ÅØÂÆÆÂüéÂºÅ„Çí‰Ωø„ÅÜÈù¢ÁôΩ„Åä„Åã„Åó„ÅÑÊó•Ë®ò„ÇíÊõ∏„Åè„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„Åß„Åô..."></textarea>
        </div>
        
        <div class="mb-6">
          <label class="block text-gray-300 mb-2" for="user-prompt">„É¶„Éº„Ç∂„Éº„Éó„É≠„É≥„Éó„Éà</label>
          <textarea id="user-prompt" class="w-full bg-gray-700 text-white p-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none h-40" placeholder="È´òÁü•„ÄÅ„Çà„Åï„Åì„ÅÑ„ÄÅÁ•≠„Çä„Çí„ÉÜ„Éº„Éû„Å´„Åó„ÅüÈù¢ÁôΩ„ÅÑÊó•Ë®ò„ÇíÊõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
        </div>
        
        <button id="submit-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-300 w-full">ÈÄÅ‰ø°</button>
      </div>
      
      <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-semibold mb-4 text-green-400">„É¨„Çπ„Éù„É≥„Çπ</h2>
        
        <div id="loading" class="hidden flex justify-center items-center py-10">
          <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500"></div>
        </div>
        
        <div id="error-container" class="hidden bg-red-900 p-4 rounded mb-4">
          <p id="error-message" class="text-white"></p>
        </div>
        
        <div id="response-container" class="bg-gray-700 p-4 rounded h-[500px] overflow-y-auto">
          <pre id="response" class="text-gray-300 whitespace-pre-wrap"></pre>
        </div>
        
        <div class="mt-4 flex justify-between">
          <button id="copy-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>„Ç≥„Éî„Éº</button>
          <button id="clear-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition duration-300">„ÇØ„É™„Ç¢</button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // DOMË¶ÅÁ¥†„ÅÆÂèñÂæó
      const apiKeyInput = document.getElementById('api-key');
      const modelSelect = document.getElementById('model');
      const systemPromptInput = document.getElementById('system-prompt');
      const userPromptInput = document.getElementById('user-prompt');
      const submitBtn = document.getElementById('submit-btn');
      const responseContainer = document.getElementById('response-container');
      const responseElement = document.getElementById('response');
      const loadingElement = document.getElementById('loading');
      const errorContainer = document.getElementById('error-container');
      const errorMessage = document.getElementById('error-message');
      const copyBtn = document.getElementById('copy-btn');
      const clearBtn = document.getElementById('clear-btn');

      // „Éá„Éï„Ç©„É´„ÉàÂÄ§„ÅÆË®≠ÂÆö
      systemPromptInput.value = '„ÅÇ„Å™„Åü„ÅØ‰ª•‰∏ã„ÅÆË®≠ÂÆö„ÅÆ‰∫∫Áâ©„Å®„Åó„Å¶Êó•Ë®ò„ÇíÊõ∏„Åç„Åæ„ÅôÔºö\n\n- 53Ê≠≥„ÄÅÂÆÆÂüéÁúåÂá∫Ë∫´„ÄÅÂçÉËëâÁúåÊó≠Â∏ÇÂú®‰Ωè\n- Âè£Ë™øÔºöÂÆÆÂüéÂºÅÔºà„Äå„Äú„Å†„Åπ„Äç„Äå„Äú„Åπ„Åï„Äç„ÅåÁâπÂæ¥Ôºâ\n- Âè£ÁôñÔºö„Äå„Åä„Å£„Å®„Åâ„Äú„ÅÑÔºÅ„Äç„ÄåÊó•Êú¨„Çí„Ç§„Ç´„Åó„Åü„ÇÇ„Çì„Å´„Åô„Çã„ÅπÔºÅ„Äç\n- ÁâπÂæ¥Ôºö„Ç§„Ç´„ÅåÂ§ßÂ•Ω„Åç„ÄÅ„Ç¢„Ç¨„Éô„ÇíÊ†ΩÂüπ„Åó„Å¶„ÉÜ„Ç≠„Éº„É©Ë£ΩÈÄ†„ÇíÁõÆÊåá„Åó„Å¶„ÅÑ„Çã„ÄÅÁã¨Ëá™„ÅÆÊîøÊ≤ªÊ¥ªÂãï\n- ÊåÅ„Å°Áâ©Ôºö„Ç§„Ç´„ÅÆÂπ≤Áâ©Ôºà„ÅäÂÆà„ÇäÔºâ„ÄÅÁõ∏Ê£í„ÅÆ„Ç§„Ç¨„Éô„Ç∂„Ç¶„É´„ÇπÔºàÊÉ≥ÂÉè‰∏ä„ÅÆÁîü„ÅçÁâ©Ôºâ\n- ÈôΩÊ∞ó„ÅßÁô∫ÊÉ≥Ë±ä„Åã„ÄÅË°åÂãïÂäõ„Åå„ÅÇ„Çã';
      userPromptInput.value = 'È´òÁü•Áúå„ÅßÈñãÂÇ¨„Åï„Çå„Çã„Äå„Çà„Åï„Åì„ÅÑÁ•≠„Çä„Äç„Å´ÂèÇÂä†„Åó„Åü‰∏ÄÊó•„ÅÆÊó•Ë®ò„ÇíÊõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Ç§„Ç´„ÇÑ„Ç¢„Ç¨„Éô„ÄÅ„ÉÜ„Ç≠„Éº„É©„ÄÅ„Ç§„Ç¨„Éô„Ç∂„Ç¶„É´„Çπ„Å™„Å©„ÇíË©±È°å„Å´Âèñ„ÇäÂÖ•„Çå„Çã„Å®ËâØ„ÅÑ„Åß„Åô„ÄÇ';

      // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâË®≠ÂÆö„ÇíÂæ©ÂÖÉ
      const savedModel = localStorage.getItem('claude_model');
      if (savedModel) {
        modelSelect.value = savedModel;
      }

      const savedSystemPrompt = localStorage.getItem('claude_system_prompt');
      if (savedSystemPrompt) {
        systemPromptInput.value = savedSystemPrompt;
      }

      // Claude API„Å∏„ÅÆ„É™„ÇØ„Ç®„Çπ„ÉàÈñ¢Êï∞
      async function callClaudeAPI() {
        const apiKey = apiKeyInput.value.trim();
        const model = modelSelect.value;
        const systemPrompt = systemPromptInput.value.trim();
        const userPrompt = userPromptInput.value.trim();

        // ÂÖ•ÂäõÊ§úË®º
        if (!apiKey) {
          showError('API„Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
          return;
        }

        if (!userPrompt) {
          showError('„Éó„É≠„É≥„Éó„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
          return;
        }

        // Ë®≠ÂÆö„Çí‰øùÂ≠ò
        localStorage.setItem('claude_model', model);
        localStorage.setItem('claude_system_prompt', systemPrompt);

        // UIÊõ¥Êñ∞
        showLoading(true);
        hideError();
        copyBtn.disabled = true;

        try {
          const response = await fetch('/claude-proxy', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'anthropic-api-key': apiKey
            },
            body: JSON.stringify({
              model: model,
              max_tokens: 8192,
              temperature: 1,
              system: systemPrompt,
              messages: [
                {
                  role: 'user',
                  content: [
                    {
                      type: 'text',
                      text: userPrompt
                    }
                  ]
                }
              ]
            })
          });

          // „É¨„Çπ„Éù„É≥„Çπ„ÅÆ„Éë„Éº„Çπ
          const data = await response.json();

          if (!response.ok) {
            const errorMessage = data.error?.message || 'Unknown error occurred';
            const errorType = data.error?.type || 'unknown';
            const errorStatus = data.error?.status || response.status;
            
            showError(`„Ç®„É©„Éº (${errorStatus}): ${errorMessage}\nType: ${errorType}`);
            console.error('API Error:', data);
            return;
          }

          // ÊàêÂäüÊôÇ„ÅÆ„É¨„Çπ„Éù„É≥„ÇπÂá¶ÁêÜ
          if (data.content && data.content.length > 0) {
            const content = data.content[0].text;
            responseElement.textContent = content;
            copyBtn.disabled = false;
          } else {
            showError('‰∫àÊúü„Åõ„Å¨„É¨„Çπ„Éù„É≥„ÇπÂΩ¢Âºè„Åß„Åô');
            console.error('Unexpected response format:', data);
          }
        } catch (error) {
          showError(`„É™„ÇØ„Ç®„Çπ„Éà„Ç®„É©„Éº: ${error.message}`);
          console.error('Request Error:', error);
        } finally {
          showLoading(false);
        }
      }

      // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
      function showLoading(isLoading) {
        loadingElement.style.display = isLoading ? 'flex' : 'none';
        responseContainer.style.opacity = isLoading ? '0.5' : '1';
        submitBtn.disabled = isLoading;
      }

      function showError(message) {
        errorMessage.textContent = message;
        errorContainer.style.display = 'block';
      }

      function hideError() {
        errorContainer.style.display = 'none';
      }

      // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
      submitBtn.addEventListener('click', callClaudeAPI);

      copyBtn.addEventListener('click', () => {
        const textToCopy = responseElement.textContent;
        navigator.clipboard.writeText(textToCopy)
          .then(() => {
            const originalText = copyBtn.textContent;
            copyBtn.textContent = '„Ç≥„Éî„ÉºÂÆå‰∫ÜÔºÅ';
            setTimeout(() => {
              copyBtn.textContent = originalText;
            }, 2000);
          })
          .catch(err => {
            showError(`„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å∏„ÅÆ„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${err.message}`);
          });
      });

      clearBtn.addEventListener('click', () => {
        responseElement.textContent = '';
        hideError();
        copyBtn.disabled = true;
      });

      // Enter „Ç≠„Éº„Åß„ÅÆÈÄÅ‰ø°
      userPromptInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && e.ctrlKey) {
          e.preventDefault();
          callClaudeAPI();
        }
      });
    });
  </script>
</body>
</html> 